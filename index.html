<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flash USDT Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body>
  <h1>Flash USDT Demo</h1>
  <button id="connectBtn">Connect MetaMask</button>
  <br /><br />
  <input type="number" id="amount" placeholder="Amount to flash" />
  <button id="flashBtn">Flash USDT</button>
  <p id="status"></p>

  <script>
    const contractAddress = "0xD20Ecb072145678B5853B7563EE5dc0a6E6981d9";
    const abi = [
      "function flashUSDT(uint256 amount) external",
      "function getBalance(address user) external view returns (uint256)"
    ];

    let provider;
    let signer;
    let contract;

    const connectBtn = document.getElementById("connectBtn");
    const flashBtn = document.getElementById("flashBtn");
    const status = document.getElementById("status");

    connectBtn.onclick = async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, abi, signer);
        status.innerText = "Connected to MetaMask";
      } else {
        status.innerText = "Please install MetaMask!";
      }
    };

    flashBtn.onclick = async () => {
      if (!contract) {
        status.innerText = "Please connect MetaMask first!";
        return;
      }
      const amount = document.getElementById("amount").value;
      if (!amount || amount <= 0) {
        status.innerText = "Enter a valid amount!";
        return;
      }
      try {
        const tx = await contract.flashUSDT(ethers.utils.parseUnits(amount, 6));
        status.innerText = "Transaction sent, waiting for confirmation...";
        await tx.wait();
        status.innerText = "Flash USDT successful!";
      } catch (err) {
        status.innerText = "Transaction failed: " + err.message;
      }
    };
  </script>
</body>
</html>